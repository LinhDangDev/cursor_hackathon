Tóm tắt các thay đổi để tạo Summary Panel:
Tóm tắt các thay đổi
1. Tạo mới: API Route cho Speech-to-Text
File: frontend/app/api/speech-to-text/route.ts
Nhận audio file từ frontend (FormData)
Chuyển audio sang base64
Gọi Google Speech-to-Text API để chuyển đổi
Trả về transcript và confidence
// Endpoint: POST /api/speech-to-text// Input: audio file (webm format)// Output: { transcript: string, confidence: number }
2. Tạo mới: SpeechRecorder Component
File: frontend/components/SpeechRecorder.tsx
Chức năng:
Detect giọng nói local: Web Speech API (real-time) + MediaRecorder (backup)
Detect giọng nói remote: MediaRecorder ghi remote stream và gửi đến API
Tự động gửi transcript qua socket khi detect được
Hiển thị trạng thái ghi âm
Props:
audioStream: Local audio stream
remoteAudioStream: Remote audio stream (đối phương)
onTranscript: Callback khi có transcript
isActive: Trạng thái active
socket: Socket connection
matchId: Match ID để gửi qua socket
3. Tạo mới: SummaryPanel Component
File: frontend/components/SummaryPanel.tsx
Chức năng:
Hiển thị panel bên phải với danh sách transcript
Mỗi item có: speaker (Bạn/Đối phương), timestamp, text
Scroll area để xem lịch sử
Styling theo neobrutalism
Props:
summaries: Array of SummaryItem
Interface:
interface SummaryItem {  id: string  text: string  timestamp: Date  speaker: 'me' | 'other'}
4. Tạo mới: ScrollArea Component
File: frontend/components/ui/scroll-area.tsx
Component scroll area cho SummaryPanel
Wrapper cho overflow-auto
5. Cập nhật: Chat Page
File: frontend/app/chat/page.tsx
Thay đổi:
Import components:
import { SpeechRecorder } from '@/components/SpeechRecorder'import { SummaryPanel } from '@/components/SummaryPanel'
Thêm state:
const [summaries, setSummaries] = useState<SummaryItem[]>([])const remoteStreamRef = useRef<MediaStream | null>(null)
Thêm socket listener:
socket.on('new-transcript', (data) => {  // Nhận transcript từ đối phương và thêm vào summaries})
Handler cho transcript:
const handleTranscript = (transcript: string, speaker: 'me' | 'other') => {  setSummaries(prev => [...prev, {    id: Date.now().toString(),    text: transcript,    timestamp: new Date(),    speaker  }])}
Cập nhật layout:
Đổi từ flex flex-col sang flex (horizontal)
Thêm SummaryPanel bên phải (width: 320px)
SpeechRecorder tự động chạy khi call active
Cập nhật WebRTC:
Lưu remote stream vào remoteStreamRef
Truyền remote stream vào SpeechRecorder
6. Cập nhật: Backend Server
File: backend/server.js
Thêm socket events:
send-transcript event:
socket.on('send-transcript', (data) => {  // Nhận transcript từ một user  // Gửi đến user còn lại với speaker label đảo ngược})
new-transcript event:
// Gửi đến đối phương với speaker label đã đảoio.to(targetSocketId).emit('new-transcript', {  matchId,  transcript,  speaker: speaker === 'me' ? 'other' : 'me',  from: ...})
Flow hoạt động
User bắt đầu call:
SpeechRecorder tự động start
Web Speech API detect giọng nói local (real-time)
MediaRecorder ghi remote stream
Khi có transcript:
Local transcript → gọi onTranscript → thêm vào summaries
Gửi qua socket (send-transcript) → đối phương nhận (new-transcript)
SummaryPanel:
Hiển thị tất cả transcripts
Phân biệt "Bạn" và "Đối phương"
Cả hai bên đều thấy transcript của nhau
Cấu trúc file
frontend/├── app/│   ├── api/│   │   └── speech-to-text/│   │       └── route.ts          [MỚI]│   └── chat/│       └── page.tsx               [CẬP NHẬT]├── components/│   ├── SpeechRecorder.tsx         [MỚI]│   ├── SummaryPanel.tsx          [MỚI]│   └── ui/│       └── scroll-area.tsx       [MỚI]└── lib/    └── speechToText.ts           [MỚI - utility functions]backend/└── server.js                     [CẬP NHẬT - thêm transcript events]
